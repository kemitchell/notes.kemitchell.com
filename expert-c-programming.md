---
title: Expert C Programming
subtitle: Deep C Secrets
types: [books]
people:
  - Peter van der Linden
tags:
  - Programming
---

# Notes

- EIEIO instruction (xxii)
- "California...eight hours behind London, and several years ahead." (xxiv)
- New Zealand sees date bugs first (xxv)
- "C is quirky, flawed, and an enormous success." --- Dennis Ritchie (1)
- "Performance is almost everything in a compiler." (3)
- ++ and -- did _not_ come from PDP-11 addressing modes (3)
- features invented for compiler writers (5)
- use preprocessor for macros that don't require extensive discussion (7)
- BASH: C preprocessor used to imitate Algol-68 syntax (8)
- Steve Johnson's Portable C Compiler '78 (9)
- originally `b=+3`, not `b+=3` (10)
- standards manuals only make sense if you already know what they mean (12)
- ISO adopted ANSI with annoying changes, then ANSI readopted ISO C (13)
- easier and cheaper to buy annotated standard than official copy (13)
- implementation-defined := compiler writer chooses what happens, must document (14)
- unspecified := behavior of something correct with no standard of imposed requirements (14)
- undefined := behavior of something incorrect, no standard-imposed requirements (14)
- constraint := must be obeyed, else undefined! (14)
- strictly conforming := only specified features ∧ doesn't exceed any implementation-defined limit ∧ no output depends on implementation-defined, unspecified, undefined features (16)
- conforming := can depend on nonportable features (16)
- /usr/group history (18)
- PATH_MAX contradiction (19)
- error in first footnote (19)
- prototypes (paramter types) from C++ (20)
- language lawyers (22)
- const only for indicating params read-only (25)
- don't use unsigned type just because will never be negative (28)
- "hacker" has two meanings like "bad" (29)
- blurb on FSF and GCC (29)
- GCC 1.34 launches a game on encountering #pragma (30)
- Mercury orbital trajectory bug (31)
- `malloc(strlen(str))` XX (32)
- sins of commission, sins of omission, sins of mission (32)
- C++ disappointing:
  - doesn't address fundamental C problems
  - classes build on deficient type model (33)
- the programmer is always right (34)
- case fall-through "misfeature" (37)
- AT&T phone disruption (38)
- default global visibility a mistake (42)
- too terse (42)
- overloaded symbols table (43)
- "some of the operators have the wrong precedence" (44)
- * and / come before + and -. Put everything else in parentheses. (47)
- fgets() instead of gets() (49)
- other systems separate command flags and arguments (51)
- maximal munch strategy (53)
- returning allocated memory v. requiring caller to allocate memory (58)
- "Memory management works best if you can write the 'free' at the same time as you write the 'malloc'." (58)
- mistake to split lint out of compiler (59)
- "Lint is your software conscience."  (59)
- the earlier bug found, the cheaper to fix (60)
- Mariner 1 algorithm bug (60)
- C declarations easy to parse for compiler (64)
- significantly and needlessly complicated (65)
- declarations resemble uses (65)
- declarator: identifier, pointers, function brackets, array indications (67)
- prefer not mixing struct and variable dec's (70)
- parameters in registers for speed (70)
- unions in structs with type info. (72)
- 100 times more structs than unions (73)
- precedence, high to low:
  - parentheses grouping
  - postfix:
    - function pointers
    - array brackets
  - prefix: pointer syntax (74)
- if const or volatile next to type, applies to type, else to pointer asterisk to immediate left (74)
- char * const * ( * next ) (); (75)
- Magic Decoder Ring for C Declarations (76)
- don't do multiple declarations in one typedef (79)
- don't put typedef in middle of declaration (79)
- namespaces: label names, tags, member names, everything else (81)
- old compilers had one namespace for all structs' and unions' members (81)
- Don't bother with typedefs for structs. (83)
- always tag struct definitions (83)
- two different thins, use two different names (83)
- cdecl (85)
- book: Data Structures with Abstract Data Types (86)

## Chapter 4
- extern int y[]; unspecified size, incomplete type (95)
- object: one definition, many external declarations (97)
- address y v. contents of address y (98)
- l-value: kjnow at compiletime (98)
- r-value: known at runtime (98)
- modifiable l-value (98)
- scaling factor (102)
- array v. pointer comparison table (103)

## Chapter 5
- "compiler driver" (110)
- link-editing, loading, runtime linking (112)
- always dynamic: libc, libsys, libX, libasl (114)
- ABI for decoupling (114)
- Only use dynamic linking. (116)
- static libraries AKA archives (116)
- static shared libraries in SUR3 (116)
- position-independent code (117)
- use PICode for libraries (118)
- pure code := no static or initialized data (118)
- just have to know header file to library pathname mapping (119)
- `nm` lists routines in a library (119)
- static linking only takes undefined symbols (121)
- interpositioning / interposing (123)
- Don't make any symbols in your program global, unless they are meant to be part of your interface! (125)
- list of identifiers to avoid (126)
- Turing Test: distinguish women from men masquerading as women (134)

## Chapter 6
- C maintains code-data dichotomy (138)
- a.out for "assembler output" (138)
- FS_MAGIC is author's birthday (139)
- 0407 a.out magic number is PDP-11 unconditional branch (139)
- ELF, COFF, BSD a.out (139)
- segment of several sections (139)
- size, nm, dump commands (140)
- BSS was Block Started by Symbol pseudo-op in IBM 704 assembler (141)
- segments layout diagram (143)
- stack frame AKA procedure activation record (145)
- alloca() on stack (145)
- need a stack for recursive calls (145)
- different stack per thread (153)
- setjmp and longjmp manipulate activation records (153)
- cb, indent, cdecl, cflow, cscope, ctags, lint, sccs, vgrind (157)
- dis, dump -Lu, ldd, nm, strings, sum (158)
- truss, ps, ctrace, debugger, file (158)
- gprof, prof, tcov, time (159)
- deadbeef, abadcate (159)
- last year of CMU programming contest (161)

## Chapter 7
- "Intel was always ready with compatible follow-on processors." (165)
- "Intel puts the 'backward' in 'backward compatible...' (166)
- 4004 for Busicom, a Japanese calculator company (166)
- never know why IBM picked 8088 for PC over superior alternatives (168)
- IBM challenging back with PowerPC and OS/2 (168)
- difficult and frustrating architecture (168)
- Digital Research decided to fly plane instead of meeting IBM (169)
- Seattle Computer Products pretty much gave away best-selling program ever. (169)
- based on Kildall's CP/M (169)
- Gates bought 959, couldn't drive it, left in Oakland warehouse (169)
- "Quick and Dirty Operating System" (169)
- "be fast or be dead" (169)
- many (4096) segment-offset pairs for same address (170)
- disk makers use decimal, not binary, capacity figures (171)
- SUID limits kernel to 512 MB (171)
- challenge: memory speed (172)
- "640K ought to be enough for anybody" (173)
- multilevel store (174)
- page in/out, swap in/out (176)
- hardware address translation (HAT) (177)
- CPU- or memory-side cache (177)
- free store: linked list of available blocks (181)
- the break: pointer at end of heap (182)
- to return to kernel, mmap /dev/zero and return with munmap (183)
- some programs don't ever free (183)
- memory corruption and memory leak (183)
- "Whenever you write malloc, write a corresponding free statement." (183)
- consider alloca() (184)
- snoop -a beeps per packet (185)
- speed- and space-optimal mallocs (185)
- company president discovers memory leak (186)
- signals modeled on hardware interrupts (188)
- "core dump" from ferrite ring days (188)
- "no data item may span a page or cache boundary" (189)
- Step on a crack, break your mother's back. (189)
- Yoyodyne Software Corporation (191)
- list of common segfault causes (192)
- car and cdr from IBM 704 (194)
- The Paging Game's public license (195)
- zarking things in crates in workshop or warehouse with the Think King (195)

## Chapter 8
- Picasso: computers uninteresting (201)
- Donald Knuth in MAD Magazine (202)
- OCT 31 equals DEC 25! (202)
- table of usual type promotions (206)
- K&R: couldn't pass structs as arguments (209)
- prototypes in included header files (211)
- arguably to cautious about extending C (212)
- cooked terminal input (212)
- "Games software is more important than generally thought." (213)
- `(**(**state[i])();` (218)
